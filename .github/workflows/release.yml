name: Release

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  semantic-release:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 0 # ensure tags & full history

      - name: Set up uv
        uses: astral-sh/setup-uv@v7

      - name: Install Python 3.12
        run: uv python install 3.12

      - name: Create virtual environment
        run: uv venv --python 3.12

      - name: Install python-semantic-release
        run: uv pip install 'python-semantic-release<10'

      - name: Semantic Release (version + publish)
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          uv run semantic-release version
          uv run semantic-release publish
